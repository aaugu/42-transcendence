{% load static %}
<!doctype html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<!-- Bootstrap / CSS -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
		<link type="text/css" href=" {% static '/css/main.css' %}" rel="stylesheet">

		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />

		<!-- Favicon handle -->
		<link rel="shortcut icon" href="#">

		<title>Pong</title>
	</head>
	<body>
		<!-- RESPONSIVE NAVBAR -->
		<nav class="d-flex justify-content-between align-items-center">
			<input type="checkbox" id="check" class="d-none">
			<label for="check" class="checkbtn pb-2">
				<i class="fas fa-bars"></i>
			</label>
			<label class="logo"><a href="/">Pong</a></label>
			<ul class="">
				<li class="text-center" id="new-game-btn"><a href="/newgame">New Game</a></li>
				<li class="text-center" id="tournament-home-btn"><a href="/tournament-home">Tournaments</a></li>
				<li class="text-center"><a href="#">Profile</a></li>
			</ul>
		</nav>
		<!-- MAIN CONTENT -->
		<div class="background-rainbow-container w-100 d-flex justify-content-center align-items-center">
			<div id="main-content" class="h-75 bg-white p-4">
				<div id="livechat" class="row h-100 mx-2 border border-primary border-2 rounded-end rounded-3">
					<div id="contact-list" class="col-lg-4 h-100 mh-100 overflow-auto d-flex flex-column justify-content-start p-0 border-end border-primary">
						<div id="livechat-menu" class="w-100 d-flex flex-column justify-content-around align-items-center border-bottom border-primary">
							<div id="user-info w-100">{{ username }}</div>
							<form action="post" id="search-bar" class="w-75 text-small">
								<input class="form-control" type="search" placeholder="contacts..." aria-label="Search">
      							<button class="btn" type="submit">Search</button>
							</form>
						</div>
						<!-- {% for contact in contact_list %} 
							<div id="contact" class="w-100 d-flex justify-content-center align-items-center border-bottom border-primary">
                                Check which id of conversation to display, in our case not the one from current user
								{% if contact.user_1.id == user %}
									{{ contact.user_2.username }}
								{% elif contact.user_2.id == user %}
									{{ contact.user_1.username }}
								{% endif %}
							</div>
						{% endfor %} -->
					</div>
					<div id="conversation" class="col d-lg-flex flex-column justify-content-center align-items-center d-none d-lg-block h-100 overflow-auto bg-lightgrey px-5">
                        {% if contact_list.em %}
                            <div class="h2 text-center mb-5">Welcome to Live Chat</div>
                            <div class="h6 text-center">Select a contact to start a conversation</div>
                        {% else %}
                            {{ contact.user_1.username }}
                        {% endif %}
					</div>
				</div>

			</div>
		</div>

		<!-- <script type="module" src="./js/router.js"></script> -->
		<script>
			const roomName = JSON.parse(document.getElementById('room-name').textContent);
	
			const chatSocket = new WebSocket(
				'ws://'
				+ window.location.host
				+ '/ws/chat/'
				+ roomName
				+ '/'
			);
	
			chatSocket.onmessage = function(e) {
				const data = JSON.parse(e.data);
				document.querySelector('#chat-log').value += (data.message + '\n');
			};
	
			chatSocket.onclose = function(e) {
				console.error('Chat socket closed unexpectedly');
			};
	
			document.querySelector('#chat-message-input').focus();
			document.querySelector('#chat-message-input').onkeyup = function(e) {
				if (e.keyCode === 13) {  // enter, return
					document.querySelector('#chat-message-submit').click();
				}
			};
	
			document.querySelector('#chat-message-submit').onclick = function(e) {
				const messageInputDom = document.querySelector('#chat-message-input');
				const message = messageInputDom.value;
				chatSocket.send(JSON.stringify({
					'message': message
				}));
				messageInputDom.value = '';
			};
		</script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	</body>
</html>